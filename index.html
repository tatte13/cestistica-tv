<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cestistica TV - Club Channel Biancoverde</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Poppins', sans-serif; }
        :root {
            --forest-green: #228B22;
            --light-forest: #3CB371;
            --dark-green: #1a6b1a;
        }
        .gradient-bg { background: linear-gradient(135deg, #228B22 0%, #1a6b1a 100%); }
        .card-hover:hover { transform: scale(1.05); transition: all 0.3s ease; }
        .video-card { transition: all 0.3s ease; }
        .video-card:hover { box-shadow: 0 0 20px rgba(34, 139, 34, 0.5); }
        .custom-scrollbar::-webkit-scrollbar { height: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1a1a1a; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #228B22; border-radius: 4px; }
        .hero-gradient { background: linear-gradient(to top, #111 0%, transparent 60%); }
        .category-scroll { scroll-behavior: smooth; }
        input:focus, textarea:focus { outline: none; box-shadow: 0 0 0 2px #3CB371; }
        .animate-pulse-slow { animation: pulse 3s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    
    <!-- Login/Register Modal -->
    <div id="authModal" class="fixed inset-0 bg-black/90 z-50 flex items-center justify-center">
        <div class="bg-gray-800 p-8 rounded-2xl max-w-md w-full mx-4 border border-green-600/30">
            <div class="text-center mb-6">
                <img id="authLogo" src="" alt="Cestistica TV" class="h-16 mx-auto mb-4 hidden">
                <h1 class="text-3xl font-bold text-white">üèÄ Cestistica TV</h1>
                <p class="text-green-400 font-medium mt-1">cestistica tv+</p>
                <p class="text-gray-400 text-sm mt-2">Il Club Channel Biancoverde</p>
            </div>
            
            <div id="loginForm">
                <h2 class="text-xl font-semibold mb-4 text-center">Accedi</h2>
                <input type="text" id="loginUsername" placeholder="Username" class="w-full p-3 rounded-lg bg-gray-700 mb-3 border border-gray-600 focus:border-green-500">
                <input type="password" id="loginPassword" placeholder="Password" class="w-full p-3 rounded-lg bg-gray-700 mb-4 border border-gray-600 focus:border-green-500">
                <button onclick="login()" class="w-full gradient-bg text-white py-3 rounded-lg font-semibold hover:opacity-90 transition">Accedi</button>
                <p class="text-center mt-4 text-gray-400">Non hai un account? <span onclick="showRegister()" class="text-green-400 cursor-pointer hover:underline">Registrati gratis</span></p>
            </div>
            
            <div id="registerForm" class="hidden">
                <h2 class="text-xl font-semibold mb-4 text-center">Registrati a cestistica tv+</h2>
                <p class="text-center text-green-400 text-sm mb-4">‚úì 100% Gratuito per sempre</p>
                <input type="text" id="regUsername" placeholder="Username" class="w-full p-3 rounded-lg bg-gray-700 mb-3 border border-gray-600">
                <input type="email" id="regEmail" placeholder="Email" class="w-full p-3 rounded-lg bg-gray-700 mb-3 border border-gray-600">
                <input type="password" id="regPassword" placeholder="Password" class="w-full p-3 rounded-lg bg-gray-700 mb-4 border border-gray-600">
                <button onclick="register()" class="w-full gradient-bg text-white py-3 rounded-lg font-semibold hover:opacity-90 transition">Iscriviti Gratis</button>
                <p class="text-center mt-4 text-gray-400">Hai gi√† un account? <span onclick="showLogin()" class="text-green-400 cursor-pointer hover:underline">Accedi</span></p>
            </div>
            <p id="authError" class="text-red-400 text-center mt-3 hidden"></p>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <header class="fixed top-0 left-0 right-0 z-40 bg-gradient-to-b from-black/90 to-transparent">
            <div class="container mx-auto px-4 py-4 flex items-center justify-between">
                <div class="flex items-center gap-6">
                    <div class="flex items-center gap-3 cursor-pointer" onclick="showHome()">
                        <img id="headerLogo" src="" alt="Logo" class="h-12 hidden">
                        <div>
                            <h1 class="text-2xl font-bold text-white">üèÄ Cestistica TV</h1>
                            <span class="text-xs text-green-400 font-medium">cestistica tv+</span>
                        </div>
                    </div>
                    <nav class="hidden md:flex gap-6 ml-8">
                        <button onclick="showHome()" class="hover:text-green-400 transition font-medium">Home</button>
                        <button onclick="filterCategory('live')" class="hover:text-green-400 transition">Live</button>
                        <button onclick="filterCategory('replays')" class="hover:text-green-400 transition">Full Match</button>
                        <button onclick="filterCategory('highlights')" class="hover:text-green-400 transition">Highlights</button>
                        <button onclick="filterCategory('altro')" class="hover:text-green-400 transition">Altro</button>
                        <button onclick="showWatchlist()" class="hover:text-green-400 transition">La Mia Lista</button>
                    </nav>
                </div>
                <div class="flex items-center gap-4">
                    <div class="relative">
                        <input type="text" id="searchInput" placeholder="Cerca..." class="bg-gray-800 px-4 py-2 rounded-full text-sm w-48 border border-gray-700 focus:border-green-500" onkeyup="searchVideos()">
                    </div>
                    <div class="relative group">
                        <button class="flex items-center gap-2 bg-green-600 px-4 py-2 rounded-full">
                            <span id="currentUser" class="font-medium"></span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="absolute right-0 mt-2 w-48 bg-gray-800 rounded-lg shadow-xl hidden group-hover:block border border-gray-700">
                            <button onclick="showAdmin()" id="adminBtn" class="w-full text-left px-4 py-3 hover:bg-gray-700 rounded-t-lg hidden">‚öôÔ∏è Admin Panel</button>
                            <button onclick="logout()" class="w-full text-left px-4 py-3 hover:bg-gray-700 rounded-lg text-red-400">üö™ Esci</button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Home Content -->
        <main id="homeContent" class="pt-20">
            <!-- Hero Section -->
            <div id="heroSection" class="relative h-[70vh] bg-cover bg-center" style="background-image: url('https://images.unsplash.com/photo-1546519638-68e109498ffc?w=1600');">
                <div class="absolute inset-0 bg-gradient-to-r from-black/80 via-black/50 to-transparent"></div>
                <div class="hero-gradient absolute inset-0"></div>
                <div class="absolute bottom-20 left-8 max-w-2xl">
                    <span class="bg-green-600 px-3 py-1 rounded-full text-sm font-medium mb-4 inline-block">üèÄ Cestistica Savonese</span>
                    <h2 class="text-5xl font-bold mb-4">Benvenuto su Cestistica TV</h2>
                    <p class="text-lg text-gray-300 mb-6">Il club channel ufficiale della Cestistica Savonese. Guarda partite live, full match replays, highlights e contenuti esclusivi del mondo biancoverde!</p>
                    <div class="flex gap-4">
                        <button onclick="playFeatured()" class="gradient-bg px-8 py-3 rounded-lg font-semibold flex items-center gap-2 hover:opacity-90 transition">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"></path></svg>
                            Guarda Ora
                        </button>
                        <button onclick="showWatchlist()" class="bg-gray-700/80 px-8 py-3 rounded-lg font-semibold flex items-center gap-2 hover:bg-gray-600 transition">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                            La Mia Lista
                        </button>
                    </div>
                </div>
            </div>

            <!-- Video Categories -->
            <div class="px-8 -mt-20 relative z-10 pb-20">
                <!-- Live Section -->
                <section id="liveSection" class="mb-12">
                    <h3 class="text-2xl font-bold mb-4 flex items-center gap-2">
                        <span class="w-3 h-3 bg-red-500 rounded-full animate-pulse-slow"></span> Live
                    </h3>
                    <div id="liveVideos" class="flex gap-4 overflow-x-auto pb-4 custom-scrollbar category-scroll"></div>
                </section>

                <!-- Full Match Replays -->
                <section id="replaysSection" class="mb-12">
                    <h3 class="text-2xl font-bold mb-4">üé¨ Full Match Replays</h3>
                    <div id="replaysVideos" class="flex gap-4 overflow-x-auto pb-4 custom-scrollbar category-scroll"></div>
                </section>

                <!-- Highlights -->
                <section id="highlightsSection" class="mb-12">
                    <h3 class="text-2xl font-bold mb-4">‚ö° Highlights</h3>
                    <div id="highlightsVideos" class="flex gap-4 overflow-x-auto pb-4 custom-scrollbar category-scroll"></div>
                </section>

                <!-- Altro -->
                <section id="altroSection" class="mb-12">
                    <h3 class="text-2xl font-bold mb-4">üì∫ Altro</h3>
                    <div id="altroVideos" class="flex gap-4 overflow-x-auto pb-4 custom-scrollbar category-scroll"></div>
                </section>
            </div>
        </main>

        <!-- Video Player Page -->
        <div id="videoPage" class="hidden pt-20 pb-20">
            <div class="container mx-auto px-4">
                <button onclick="showHome()" class="mb-4 flex items-center gap-2 text-green-400 hover:underline">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    Torna alla Home
                </button>
                
                <div class="grid lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2">
                        <!-- Video Player -->
                        <div class="aspect-video bg-black rounded-xl overflow-hidden shadow-2xl">
                            <iframe id="videoPlayer" class="w-full h-full" frameborder="0" allowfullscreen allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe>
                        </div>
                        
                        <!-- Video Info -->
                        <div class="mt-6">
                            <div class="flex items-start justify-between">
                                <div>
                                    <h2 id="videoTitle" class="text-2xl font-bold"></h2>
                                    <p id="videoCategory" class="text-green-400 mt-1"></p>
                                    <p id="videoDate" class="text-gray-400 text-sm mt-1"></p>
                                </div>
                                <button id="watchlistBtn" onclick="toggleWatchlist()" class="flex items-center gap-2 bg-gray-700 px-4 py-2 rounded-lg hover:bg-gray-600 transition">
                                    <svg id="watchlistIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>
                                    <span id="watchlistText">Aggiungi alla Lista</span>
                                </button>
                            </div>
                            <p id="videoDescription" class="text-gray-300 mt-4"></p>
                        </div>

                        <!-- Comments Section -->
                        <div class="mt-8 bg-gray-800 rounded-xl p-6">
                            <h3 class="text-xl font-bold mb-4">üí¨ Commenti</h3>
                            <div class="flex gap-4 mb-6">
                                <input type="text" id="commentInput" placeholder="Scrivi un commento..." class="flex-1 bg-gray-700 px-4 py-3 rounded-lg border border-gray-600">
                                <button onclick="addComment()" class="gradient-bg px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition">Invia</button>
                            </div>
                            <div id="commentsList" class="space-y-4"></div>
                        </div>
                    </div>

                    <!-- Related Videos -->
                    <div>
                        <h3 class="text-xl font-bold mb-4">Video Correlati</h3>
                        <div id="relatedVideos" class="space-y-4"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Watchlist Page -->
        <div id="watchlistPage" class="hidden pt-24 pb-20">
            <div class="container mx-auto px-4">
                <h2 class="text-3xl font-bold mb-6">‚ù§Ô∏è La Mia Lista</h2>
                <div id="watchlistVideos" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"></div>
                <p id="emptyWatchlist" class="text-gray-400 text-center py-20 hidden">La tua lista √® vuota. Aggiungi video cliccando sul cuore!</p>
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="adminPage" class="hidden pt-24 pb-20">
            <div class="container mx-auto px-4">
                <h2 class="text-3xl font-bold mb-6">‚öôÔ∏è Admin Panel</h2>
                
                <div class="grid lg:grid-cols-2 gap-8">
                    <!-- Add Video Form -->
                    <div class="bg-gray-800 rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4">‚ûï Aggiungi Nuovo Video</h3>
                        <input type="text" id="newVideoTitle" placeholder="Titolo" class="w-full bg-gray-700 px-4 py-3 rounded-lg mb-3 border border-gray-600">
                        <input type="text" id="newVideoUrl" placeholder="URL YouTube (es: https://youtube.com/watch?v=...)" class="w-full bg-gray-700 px-4 py-3 rounded-lg mb-3 border border-gray-600">
                        <textarea id="newVideoDesc" placeholder="Descrizione" class="w-full bg-gray-700 px-4 py-3 rounded-lg mb-3 border border-gray-600 h-24"></textarea>
                        <select id="newVideoCategory" class="w-full bg-gray-700 px-4 py-3 rounded-lg mb-3 border border-gray-600">
                            <option value="live">Live</option>
                            <option value="replays">Full Match Replays</option>
                            <option value="highlights">Highlights</option>
                            <option value="altro">Altro</option>
                        </select>
                        <input type="text" id="newVideoThumbnail" placeholder="URL Thumbnail (opzionale)" class="w-full bg-gray-700 px-4 py-3 rounded-lg mb-4 border border-gray-600">
                        <button onclick="addVideo()" class="w-full gradient-bg py-3 rounded-lg font-semibold hover:opacity-90 transition">Aggiungi Video</button>
                    </div>

                    <!-- Logo Upload -->
                    <div class="bg-gray-800 rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4">üñºÔ∏è Logo del Sito</h3>
                        <div class="border-2 border-dashed border-gray-600 rounded-xl p-8 text-center">
                            <img id="logoPreview" src="" alt="Logo Preview" class="h-24 mx-auto mb-4 hidden">
                            <p class="text-gray-400 mb-4">Carica il logo della Cestistica Savonese</p>
                            <input type="file" id="logoInput" accept="image/*" onchange="uploadLogo(event)" class="hidden">
                            <button onclick="document.getElementById('logoInput').click()" class="bg-green-600 px-6 py-2 rounded-lg hover:bg-green-700 transition">Seleziona Immagine</button>
                            <button onclick="removeLogo()" class="ml-2 bg-red-600 px-6 py-2 rounded-lg hover:bg-red-700 transition">Rimuovi</button>
                        </div>
                    </div>
                </div>

                <!-- Video Management -->
                <div class="bg-gray-800 rounded-xl p-6 mt-8">
                    <h3 class="text-xl font-bold mb-4">üìπ Gestione Video</h3>
                    <div id="adminVideoList" class="space-y-3 max-h-96 overflow-y-auto"></div>
                </div>

                <!-- Members List -->
                <div class="bg-gray-800 rounded-xl p-6 mt-8">
                    <h3 class="text-xl font-bold mb-4">üë• Membri Registrati (cestistica tv+)</h3>
                    <div id="membersList" class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-700">
                                <tr>
                                    <th class="px-4 py-3 text-left">Username</th>
                                    <th class="px-4 py-3 text-left">Email</th>
                                    <th class="px-4 py-3 text-left">Data Registrazione</th>
                                    <th class="px-4 py-3 text-left">Tipo</th>
                                </tr>
                            </thead>
                            <tbody id="membersTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 border-t border-gray-800 py-8 mt-auto">
        <div class="container mx-auto px-4 text-center">
            <p class="text-gray-400">¬© 2024 Cestistica TV - Club Channel Biancoverde</p>
            <p class="text-green-400 text-sm mt-2">cestistica tv+ | Membership Gratuita</p>
        </div>
    </footer>

    <script>
        // Initialize Data
        let currentUser = null;
        let currentVideo = null;

        // Default Videos
        const defaultVideos = [
            { id: 1, title: "Cestistica Savonese vs Riviera Live", category: "live", url: "https://www.youtube.com/watch?v=dQw4w9WgXcQ", thumbnail: "https://images.unsplash.com/photo-1546519638-68e109498ffc?w=400", description: "Partita live del campionato regionale", date: "2024-01-15", comments: [] },
            { id: 2, title: "Full Match: Cestistica vs Albenga", category: "replays", url: "https://www.youtube.com/watch?v=dQw4w9WgXcQ", thumbnail: "https://images.unsplash.com/photo-1559692048-79a3f837883d?w=400", description: "Replay completo della partita casalinga", date: "2024-01-10", comments: [] },
            { id: 3, title: "Top 10 Giocate Stagione", category: "highlights", url: "https://www.youtube.com/watch?v=dQw4w9WgXcQ", thumbnail: "https://images.unsplash.com/photo-1574623452334-1e0ac2b3ccb4?w=400", description: "Le migliori giocate della stagione biancoverde", date: "2024-01-08", comments: [] },
            { id: 4, title: "Intervista Coach", category: "altro", url: "https://www.youtube.com/watch?v=dQw4w9WgXcQ", thumbnail: "https://images.unsplash.com/photo-1504450758481-7338bbe7f5a0?w=400", description: "Intervista esclusiva al nostro coach", date: "2024-01-05", comments: [] },
            { id: 5, title: "Derby Savonese - Replay Completo", category: "replays", url: "https://www.youtube.com/watch?v=dQw4w9WgXcQ", thumbnail: "https://images.unsplash.com/photo-1519861531473-9200262188bf?w=400", description: "Il derby pi√π atteso della stagione", date: "2024-01-12", comments: [] },
            { id: 6, title: "Highlights Gennaio 2024", category: "highlights", url: "https://www.youtube.com/watch?v=dQw4w9WgXcQ", thumbnail: "https://images.unsplash.com/photo-1608245449230-4ac19066d2d0?w=400", description: "I migliori momenti di gennaio", date: "2024-01-20", comments: [] },
            { id: 7, title: "Behind the Scenes - Allenamento", category: "altro", url: "https://www.youtube.com/watch?v=dQw4w9WgXcQ", thumbnail: "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=400", description: "Un giorno di allenamento con la squadra", date: "2024-01-18", comments: [] }
        ];

        // Initialize localStorage
        function initData() {
            if (!localStorage.getItem('cesticaUsers')) {
                localStorage.setItem('cesticaUsers', JSON.stringify([
                    { username: 'tatte13', password: 'Matteo13', email: 'admin@cestistica.tv', isAdmin: true, date: '2024-01-01' }
                ]));
            }
            if (!localStorage.getItem('cesticaVideos')) {
                localStorage.setItem('cesticaVideos', JSON.stringify(defaultVideos));
            }
            if (!localStorage.getItem('cesticaWatchlist')) {
                localStorage.setItem('cesticaWatchlist', JSON.stringify({}));
            }
        }

        // Auth Functions
        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const users = JSON.parse(localStorage.getItem('cesticaUsers'));
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('cesticaCurrentUser', JSON.stringify(user));
                document.getElementById('authModal').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                document.getElementById('currentUser').textContent = user.username;
                if (user.isAdmin) {
                    document.getElementById('adminBtn').classList.remove('hidden');
                }
                loadVideos();
                loadLogo();
            } else {
                showError('Username o password non corretti');
            }
        }

        function register() {
            const username = document.getElementById('regUsername').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            
            if (!username || !email || !password) {
                showError('Compila tutti i campi');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('cesticaUsers'));
            if (users.find(u => u.username === username)) {
                showError('Username gi√† esistente');
                return;
            }
            
            const newUser = { username, email, password, isAdmin: false, date: new Date().toISOString().split('T')[0] };
            users.push(newUser);
            localStorage.setItem('cesticaUsers', JSON.stringify(users));
            
            currentUser = newUser;
            localStorage.setItem('cesticaCurrentUser', JSON.stringify(newUser));
            document.getElementById('authModal').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('currentUser').textContent = newUser.username;
            loadVideos();
            loadLogo();
        }

        function logout() {
            localStorage.removeItem('cesticaCurrentUser');
            location.reload();
        }

        function showLogin() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
        }

        function showRegister() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }

        function showError(msg) {
            const el = document.getElementById('authError');
            el.textContent = msg;
            el.classList.remove('hidden');
            setTimeout(() => el.classList.add('hidden'), 3000);
        }

        // Video Functions
        function loadVideos() {
            const videos = JSON.parse(localStorage.getItem('cesticaVideos'));
            
            ['live', 'replays', 'highlights', 'altro'].forEach(cat => {
                const container = document.getElementById(cat + 'Videos');
                const catVideos = videos.filter(v => v.category === cat);
                
                if (catVideos.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 py-8">Nessun video in questa categoria</p>';
                } else {
                    container.innerHTML = catVideos.map(v => createVideoCard(v)).join('');
                }
            });
        }

        function createVideoCard(video) {
            const watchlist = JSON.parse(localStorage.getItem('cesticaWatchlist'));
            const userWatchlist = watchlist[currentUser?.username] || [];
            const inWatchlist = userWatchlist.includes(video.id);
            
            return `
                <div class="video-card min-w-[280px] bg-gray-800 rounded-xl overflow-hidden cursor-pointer card-hover" onclick="playVideo(${video.id})">
                    <div class="relative">
                        <img src="${video.thumbnail}" alt="${video.title}" class="w-full h-40 object-cover">
                        <div class="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 hover:opacity-100 transition">
                            <svg class="w-16 h-16 text-white" fill="currentColor" viewBox="0 0 20 20"><path d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"></path></svg>
                        </div>
                        ${video.category === 'live' ? '<span class="absolute top-2 left-2 bg-red-600 px-2 py-1 rounded text-xs font-bold animate-pulse">LIVE</span>' : ''}
                        <button onclick="event.stopPropagation(); quickToggleWatchlist(${video.id})" class="absolute top-2 right-2 p-2 bg-black/60 rounded-full hover:bg-green-600 transition">
                            <svg class="w-5 h-5 ${inWatchlist ? 'text-red-500 fill-current' : 'text-white'}" fill="${inWatchlist ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>
                        </button>
                    </div>
                    <div class="p-4">
                        <h4 class="font-semibold truncate">${video.title}</h4>
                        <p class="text-sm text-gray-400 mt-1">${video.date}</p>
                    </div>
                </div>
            `;
        }

        function playVideo(id) {
            const videos = JSON.parse(localStorage.getItem('cesticaVideos'));
            const video = videos.find(v => v.id === id);
            if (!video) return;
            
            currentVideo = video;
            
            // Extract YouTube ID
            let videoId = '';
            if (video.url.includes('youtube.com/watch?v=')) {
                videoId = video.url.split('v=')[1].split('&')[0];
            } else if (video.url.includes('youtu.be/')) {
                videoId = video.url.split('youtu.be/')[1].split('?')[0];
            }
            
            document.getElementById('videoPlayer').src = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
            document.getElementById('videoTitle').textContent = video.title;
            document.getElementById('videoCategory').textContent = getCategoryLabel(video.category);
            document.getElementById('videoDate').textContent = video.date;
            document.getElementById('videoDescription').textContent = video.description;
            
            updateWatchlistButton();
            loadComments();
            loadRelatedVideos(video.category, id);
            
            document.getElementById('homeContent').classList.add('hidden');
            document.getElementById('watchlistPage').classList.add('hidden');
            document.getElementById('adminPage').classList.add('hidden');
            document.getElementById('videoPage').classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        function playFeatured() {
            const videos = JSON.parse(localStorage.getItem('cesticaVideos'));
            if (videos.length > 0) {
                playVideo(videos[0].id);
            }
        }

        function getCategoryLabel(cat) {
            const labels = { live: 'üî¥ Live', replays: 'üé¨ Full Match Replay', highlights: '‚ö° Highlights', altro: 'üì∫ Altro' };
            return labels[cat] || cat;
        }

        function loadRelatedVideos(category, currentId) {
            const videos = JSON.parse(localStorage.getItem('cesticaVideos'));
            const related = videos.filter(v => v.category === category && v.id !== currentId).slice(0, 5);
            
            document.getElementById('relatedVideos').innerHTML = related.map(v => `
                <div class="flex gap-3 bg-gray-800 rounded-lg overflow-hidden cursor-pointer hover:bg-gray-700 transition" onclick="playVideo(${v.id})">
                    <img src="${v.thumbnail}" alt="${v.title}" class="w-32 h-20 object-cover">
                    <div class="py-2 pr-2">
                        <h4 class="font-medium text-sm line-clamp-2">${v.title}</h4>
                        <p class="text-xs text-gray-400 mt-1">${v.date}</p>
                    </div>
                </div>
            `).join('');
        }

        // Comments
        function loadComments() {
            const videos = JSON.parse(localStorage.getItem('cesticaVideos'));
            const video = videos.find(v => v.id === currentVideo.id);
            const comments = video.comments || [];
            
            if (comments.length === 0) {
                document.getElementById('commentsList').innerHTML = '<p class="text-gray-500 text-center py-8">Nessun commento ancora. Sii il primo!</p>';
            } else {
                document.getElementById('commentsList').innerHTML = comments.map(c => `
                    <div class="bg-gray-700 rounded-lg p-4">
                        <div class="flex items-center gap-2 mb-2">
                            <div class="w-8 h-8 bg-green-600 rounded-full flex items-center justify-center font-bold">${c.user.charAt(0).toUpperCase()}</div>
                            <span class="font-medium">${c.user}</span>
                            <span class="text-gray-400 text-sm">${c.date}</span>
                        </div>
                        <p class="text-gray-300">${c.text}</p>
                    </div>
                `).join('');
            }
        }

        function addComment() {
            const text = document.getElementById('commentInput').value.trim();
            if (!text) return;
            
            const videos = JSON.parse(localStorage.getItem('cesticaVideos'));
            const videoIndex = videos.findIndex(v => v.id === currentVideo.id);
            
            if (!videos[videoIndex].comments) videos[videoIndex].comments = [];
            
            videos[videoIndex].comments.unshift({
                user: currentUser.username,
                text: text,
                date: new Date().toLocaleString('it-IT')
            });
            
            localStorage.setItem('cesticaVideos', JSON.stringify(videos));
            document.getElementById('commentInput').value = '';
            loadComments();
        }

        // Watchlist
        function toggleWatchlist() {
            const watchlist = JSON.parse(localStorage.getItem('cesticaWatchlist'));
            if (!watchlist[currentUser.username]) watchlist[currentUser.username] = [];
            
            const index = watchlist[currentUser.username].indexOf(currentVideo.id);
            if (index > -1) {
                watchlist[currentUser.username].splice(index, 1);
            } else {
                watchlist[currentUser.username].push(currentVideo.id);
            }
            
            localStorage.setItem('cesticaWatchlist', JSON.stringify(watchlist));
            updateWatchlistButton();
        }

        function quickToggleWatchlist(videoId) {
            const watchlist = JSON.parse(localStorage.getItem('cesticaWatchlist'));
            if (!watchlist[currentUser.username]) watchlist[currentUser.username] = [];
            
            const index = watchlist[currentUser.username].indexOf(videoId);
            if (index > -1) {
                watchlist[currentUser.username].splice(index, 1);
            } else {
                watchlist[currentUser.username].push(videoId);
            }
            
            localStorage.setItem('cesticaWatchlist', JSON.stringify(watchlist));
            loadVideos();
        }

        function updateWatchlistButton() {
            const watchlist = JSON.parse(localStorage.getItem('cesticaWatchlist'));
            const userWatchlist = watchlist[currentUser.username] || [];
            const inWatchlist = userWatchlist.includes(currentVideo.id);
            
            document.getElementById('watchlistIcon').setAttribute('fill', inWatchlist ? 'currentColor' : 'none');
            document.getElementById('watchlistIcon').classList.toggle('text-red-500', inWatchlist);
            document.getElementById('watchlistText').textContent = inWatchlist ? 'Nella Mia Lista' : 'Aggiungi alla Lista';
        }

        function showWatchlist() {
            const watchlist = JSON.parse(localStorage.getItem('cesticaWatchlist'));
            const userWatchlist = watchlist[currentUser.username] || [];
            const videos = JSON.parse(localStorage.getItem('cesticaVideos'));
            const watchlistVideos = videos.filter(v => userWatchlist.includes(v.id));
            
            document.getElementById('homeContent').classList.add('hidden');
            document.getElementById('videoPage').classList.add('hidden');
            document.getElementById('adminPage').classList.add('hidden');
            document.getElementById('watchlistPage').classList.remove('hidden');
            
            if (watchlistVideos.length === 0) {
                document.getElementById('watchlistVideos').innerHTML = '';
                document.getElementById('emptyWatchlist').classList.remove('hidden');
            } else {
                document.getElementById('emptyWatchlist').classList.add('hidden');
                document.getElementById('watchlistVideos').innerHTML = watchlistVideos.map(v => createVideoCard(v)).join('');
            }
        }

        // Navigation
        function showHome() {
            document.getElementById('videoPlayer').src = '';
            document.getElementById('homeContent').classList.remove('hidden');
            document.getElementById('videoPage').classList.add('hidden');
            document.getElementById('watchlistPage').classList.add('hidden');
            document.getElementById('adminPage').classList.add('hidden');
            loadVideos();
        }

        function filterCategory(category) {
            showHome();
            setTimeout(() => {
                document.getElementById(category + 'Section').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        function searchVideos() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const videos = JSON.parse(localStorage.getItem('cesticaVideos'));
            
            if (query.length < 2) {
                loadVideos();
                return;
            }
            
            const filtered = videos.filter(v => v.title.toLowerCase().includes(query) || v.description.toLowerCase().includes(query));
            
            ['live', 'replays', 'highlights', 'altro'].forEach(cat => {
                const container = document.getElementById(cat + 'Videos');
                const catVideos = filtered.filter(v => v.category === cat);
                container.innerHTML = catVideos.length ? catVideos.map(v => createVideoCard(v)).join('') : '<p class="text-gray-500 py-4">Nessun risultato</p>';
            });
        }

        // Admin Functions
        function showAdmin() {
            if (!currentUser.isAdmin) return;
            
            document.getElementById('homeContent').classList.add('hidden');
            document.getElementById('videoPage').classList.add('hidden');
            document.getElementById('watchlistPage').classList.add('hidden');
            document.getElementById('adminPage').classList.remove('hidden');
            
            loadAdminVideoList();
            loadMembersList();
        }

        function addVideo() {
            const title = document.getElementById('newVideoTitle').value;
            const url = document.getElementById('newVideoUrl').value;
            const desc = document.getElementById('newVideoDesc').value;
            const category = document.getElementById('newVideoCategory').value;
            let thumbnail = document.getElementById('newVideoThumbnail').value;
            
            if (!title || !url) {
                alert('Inserisci titolo e URL');
                return;
            }
            
            // Auto-generate thumbnail from YouTube
            if (!thumbnail) {
                let videoId = '';
                if (url.includes('youtube.com/watch?v=')) {
                    videoId = url.split('v=')[1].split('&')[0];
                } else if (url.includes('youtu.be/')) {
                    videoId = url.split('youtu.be/')[1].split('?')[0];
                }
                if (videoId) {
                    thumbnail = `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`;
                }
            }
            
            const videos = JSON.parse(localStorage.getItem('cesticaVideos'));
            const newId = Math.max(...videos.map(v => v.id), 0) + 1;
            
            videos.push({
                id: newId,
                title,
                url,
                description: desc,
                category,
                thumbnail: thumbnail || 'https://images.unsplash.com/photo-1546519638-68e109498ffc?w=400',
                date: new Date().toISOString().split('T')[0],
                comments: []
            });
            
            localStorage.setItem('cesticaVideos', JSON.stringify(videos));
            
            // Clear form
            document.getElementById('newVideoTitle').value = '';
            document.getElementById('newVideoUrl').value = '';
            document.getElementById('newVideoDesc').value = '';
            document.getElementById('newVideoThumbnail').value = '';
            
            loadAdminVideoList();
            alert('Video aggiunto con successo!');
        }

        function loadAdminVideoList() {
            const videos = JSON.parse(localStorage.getItem('cesticaVideos'));
            document.getElementById('adminVideoList').innerHTML = videos.map(v => `
                <div class="flex items-center justify-between bg-gray-700 rounded-lg p-4">
                    <div class="flex items-center gap-4">
                        <img src="${v.thumbnail}" alt="${v.title}" class="w-24 h-16 object-cover rounded">
                        <div>
                            <h4 class="font-medium">${v.title}</h4>
                            <p class="text-sm text-gray-400">${getCategoryLabel(v.category)} ‚Ä¢ ${v.date}</p>
                        </div>
                    </div>
                    <button onclick="deleteVideo(${v.id})" class="bg-red-600 px-4 py-2 rounded-lg hover:bg-red-700 transition">Elimina</button>
                </div>
            `).join('');
        }

        function deleteVideo(id) {
            if (!confirm('Sei sicuro di voler eliminare questo video?')) return;
            
            let videos = JSON.parse(localStorage.getItem('cesticaVideos'));
            videos = videos.filter(v => v.id !== id);
            localStorage.setItem('cesticaVideos', JSON.stringify(videos));
            loadAdminVideoList();
        }

        function loadMembersList() {
            const users = JSON.parse(localStorage.getItem('cesticaUsers'));
            document.getElementById('membersTableBody').innerHTML = users.map(u => `
                <tr class="border-b border-gray-700">
                    <td class="px-4 py-3">${u.username}</td>
                    <td class="px-4 py-3">${u.email}</td>
                    <td class="px-4 py-3">${u.date}</td>
                    <td class="px-4 py-3"><span class="px-2 py-1 rounded text-xs ${u.isAdmin ? 'bg-yellow-600' : 'bg-green-600'}">${u.isAdmin ? 'Admin' : 'cestistica tv+'}</span></td>
                </tr>
            `).join('');
        }

        // Logo Functions
        function uploadLogo(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const logoData = e.target.result;
                    localStorage.setItem('cesticaLogo', logoData);
                    loadLogo();
                };
                reader.readAsDataURL(file);
            }
        }

        function removeLogo() {
            localStorage.removeItem('cesticaLogo');
            loadLogo();
        }

        function loadLogo() {
            const logo = localStorage.getItem('cesticaLogo');
            const headerLogo = document.getElementById('headerLogo');
            const authLogo = document.getElementById('authLogo');
            const logoPreview = document.getElementById('logoPreview');
            
            if (logo) {
                headerLogo.src = logo;
                headerLogo.classList.remove('hidden');
                authLogo.src = logo;
                authLogo.classList.remove('hidden');
                logoPreview.src = logo;
                logoPreview.classList.remove('hidden');
            } else {
                headerLogo.classList.add('hidden');
                authLogo.classList.add('hidden');
                logoPreview.classList.add('hidden');
            }
        }

        // Check for existing session
        function checkSession() {
            initData();
            const savedUser = localStorage.getItem('cesticaCurrentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                document.getElementById('authModal').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                document.getElementById('currentUser').textContent = currentUser.username;
                if (currentUser.isAdmin) {
                    document.getElementById('adminBtn').classList.remove('hidden');
                }
                loadVideos();
                loadLogo();
            }
        }

        // Initialize
        checkSession();
    </script>
</body>
</html>
